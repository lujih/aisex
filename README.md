# ç§˜å¯†èŠ±å›­ (Secret Garden) - æä¹ç»Ÿè®¡

[![Deploy to Cloudflare Workers](https://deploy.workers.cloudflare.com/button)](https://deploy.workers.cloudflare.com/?url=https://github.com/lujih/aisex)

**ç§˜å¯†èŠ±å›­ (Secret Garden)** æ˜¯ä¸€ä¸ªåŸºäº Cloudflare Workers å’Œ D1 æ•°æ®åº“æ„å»ºçš„ç§å¯†ä¸ªäººç”Ÿæ´»è®°å½•ä¸ç»Ÿè®¡å·¥å…·ã€‚å®ƒæ— éœ€è´­ä¹°æœåŠ¡å™¨ï¼Œå®Œå…¨å…è´¹æ‰˜ç®¡åœ¨ Cloudflare çš„è¾¹ç¼˜ç½‘ç»œä¸Šï¼Œæ‹¥æœ‰æè‡´çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚

> **å½“å‰ç‰ˆæœ¬**: v6.0 (D1 æé€Ÿç‰ˆ)

## âœ¨ ä¸»è¦ç‰¹æ€§

*   **âš¡ æè‡´æ€§èƒ½**: åç«¯è¿ç§»è‡³ Cloudflare D1 (SQLite)ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ¯«ç§’çº§å“åº”ã€‚
*   **ğŸ“Š æ•°æ®å¯è§†åŒ–**: å†…ç½® Chart.js å›¾è¡¨ï¼Œè‡ªåŠ¨ç”Ÿæˆæœˆåº¦è¶‹åŠ¿ã€ç±»å‹åˆ†å¸ƒã€æ»¡æ„åº¦åˆ†æã€‚
*   **ğŸ“ è¯¦å°½è®°å½•**: æ”¯æŒè®°å½•æ—¶é•¿ã€ä½“ä½ã€å¿ƒæƒ…ã€åœ°ç‚¹ã€åŠ©å…´ææ–™ã€ç©å…·ä½¿ç”¨åŠè¯¦ç»†ä½“éªŒå¤‡æ³¨ã€‚
*   **ğŸ”„ å®Œæ•´äº¤äº’**: æ”¯æŒ**ç¼–è¾‘å›æ˜¾**ã€**æ— é™æ»šåŠ¨åŠ è½½**ã€**ä¿®æ”¹å¯†ç **ã€‚
*   **ğŸŒ æ—¶åŒºæ”¯æŒ**: è‡ªåŠ¨å¤„ç†æ—¶åŒºé—®é¢˜ï¼Œæ— è®ºèº«åœ¨ä½•å¤„ï¼Œè®°å½•çš„æ—¶é—´æ°¸è¿œå‡†ç¡®ã€‚
*   **ğŸ† æä¹æ’è¡Œæ¦œ**: åŒ¿åçš„å…¨å±€æ’è¡Œæ¦œç³»ç»Ÿ (Top 50)ã€‚
*   **â±ï¸ å†…ç½®è®¡æ—¶å™¨**: æ²‰æµ¸å¼è®¡æ—¶å·¥å…·ï¼Œæ–¹ä¾¿è®°å½• session æ—¶é•¿ã€‚

## ğŸš€ å¿«é€Ÿéƒ¨ç½² (æ¨è)

### ç¬¬ä¸€æ­¥ï¼šä¸€é”®éƒ¨ç½²
ç‚¹å‡»ä¸Šæ–¹çš„ **Deploy to Cloudflare Workers** æŒ‰é’®ã€‚

1.  Cloudflare ä¼šå¼•å¯¼ä½ æˆæƒ GitHub è´¦å·ã€‚
2.  åœ¨éƒ¨ç½²é…ç½®é¡µé¢ï¼ŒCloudflare ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°éœ€è¦ D1 æ•°æ®åº“ã€‚
3.  **å…³é”®æ­¥éª¤**ï¼šè¯·ç¡®ä¿å…è®¸ Cloudflare åˆ›å»ºä¸€ä¸ªæ–°çš„ D1 æ•°æ®åº“ï¼ˆé€šå¸¸ä¼šè‡ªåŠ¨å‘½åæˆ–è®©ä½ è¾“å…¥åç§°ï¼‰ã€‚
4.  ç‚¹å‡» "Save and Deploy"ã€‚

### ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¯†é’¥ (å®‰å…¨å¿…é€‰)
éƒ¨ç½²å®Œæˆåï¼Œä¸ºäº†ä¿è¯è´¦æˆ·å®‰å…¨ï¼Œè¯·ä¿®æ”¹ JWT å¯†é’¥ï¼š

1.  è¿›å…¥ [Cloudflare Dashboard](https://dash.cloudflare.com/)ã€‚
2.  è¿›å…¥ **Workers & Pages** -> é€‰æ‹©åˆšéƒ¨ç½²çš„é¡¹ç›® (aisex)ã€‚
3.  ç‚¹å‡» **Settings** -> **Variables and Secrets**ã€‚
4.  æ·»åŠ ä¸€ä¸ªå˜é‡ï¼š
    *   å˜é‡å: `JWT_SECRET`
    *   å€¼: è¾“å…¥ä¸€ä¸²éšæœºä¸”å¤æ‚çš„å­—ç¬¦ä¸² (ä¾‹å¦‚: `my-super-secret-key-999`)ã€‚
5.  ç‚¹å‡» **Deploy** (æˆ– Redeploy) ä½¿é…ç½®ç”Ÿæ•ˆã€‚

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“ (é‡è¦)
ä¸€é”®éƒ¨ç½²åªä¼šåˆ›å»ºç©ºæ•°æ®åº“ï¼Œä½ éœ€è¦æ‰‹åŠ¨å¯¼å…¥è¡¨ç»“æ„ï¼š

1.  åœ¨ Cloudflare Dashboard å·¦ä¾§èœå•ç‚¹å‡» **D1 SQL Database**ã€‚
2.  ç‚¹å‡»åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“åç§°ã€‚
3.  ç‚¹å‡» **Console** (æ§åˆ¶å°) æ ‡ç­¾é¡µã€‚
4.  å¤åˆ¶æœ¬é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `schema.sql` æ–‡ä»¶å†…å®¹ã€‚
5.  ç²˜è´´åˆ°æ§åˆ¶å°è¾“å…¥æ¡†ä¸­ï¼Œç‚¹å‡» **Execute**ã€‚
6.  çœ‹åˆ° "Success" å³è¡¨ç¤ºå®Œæˆï¼ç°åœ¨å¯ä»¥è®¿é—®ä½ çš„ Workers åŸŸåè¿›è¡Œæ³¨å†Œå’Œä½¿ç”¨äº†ã€‚

---

## ğŸ› ï¸ æœ¬åœ°å¼€å‘ä¸æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· (CLI)ï¼š

1.  **å…‹éš†é¡¹ç›®**
    ```bash
    git clone https://github.com/lujih/aisex.git
    cd aisex
    ```

2.  **åˆ›å»º D1 æ•°æ®åº“**
    ```bash
    npx wrangler d1 create secret-garden-db
    ```
    *å¤åˆ¶ç»ˆç«¯è¿”å›çš„ `database_id`ï¼Œå¡«å…¥ `wrangler.toml` æ–‡ä»¶ä¸­ã€‚*

3.  **åˆå§‹åŒ–è¡¨ç»“æ„**
    ```bash
    npx wrangler d1 execute secret-garden-db --local --file=./schema.sql
    ```

4.  **æœ¬åœ°è¿è¡Œ**
    ```bash
    npx wrangler dev
    ```

5.  **éƒ¨ç½²ä¸Šçº¿**
    ```bash
    # å…ˆåˆå§‹åŒ–è¿œç¨‹æ•°æ®åº“è¡¨ç»“æ„
    npx wrangler d1 execute secret-garden-db --remote --file=./schema.sql
    
    # è®¾ç½®å¯†é’¥
    npx wrangler secret put JWT_SECRET
    
    # å‘å¸ƒ
    npx wrangler deploy
    ```

## ğŸ“‚ é¡¹ç›®ç»“æ„

*   `worker.js`: æ ¸å¿ƒé€»è¾‘æ–‡ä»¶ã€‚åŒ…å«äº†åç«¯ API è·¯ç”±ã€æ•°æ®åº“æ“ä½œé€»è¾‘ä»¥åŠå†…åµŒçš„å‰ç«¯ HTML/JS ä»£ç ã€‚
*   `schema.sql`: æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼Œå®šä¹‰äº† `users` å’Œ `records` è¡¨ç»“æ„ã€‚
*   `wrangler.toml`: Cloudflare é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº† D1 æ•°æ®åº“ç»‘å®šã€‚

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›ä¸ªäººå­¦ä¹ å’Œè®°å½•ä½¿ç”¨ã€‚æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æ‚¨è‡ªå·±çš„ Cloudflare D1 æ•°æ®åº“ä¸­ï¼Œå¼€å‘è€…æ— æ³•æŸ¥çœ‹ä»»ä½•æ•°æ®ã€‚è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„ Cloudflare è´¦å·å’Œ JWT å¯†é’¥ã€‚

---
*Created by [lujih](https://github.com/lujih)*